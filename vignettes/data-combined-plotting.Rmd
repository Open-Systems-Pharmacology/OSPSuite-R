---
title: "Visualizations with `DataCombined`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualizations with `DataCombined`}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  dpi = 300,
  comment = "#>",
  out.width = "100%",
  fig.height = 6,
  fig.width = 8
)
```

## Introduction

You have already seen how the `DataCombined` class can be utilized to store observed and/or simulated data (if not, read [Working with `DataCombined` class](data-combined.html)).

Let's first create a `DataCombined` object, which we will use to demonstrate different visualizations available.

```{r}
library(ospsuite)

# simulated data
simFilePath <- system.file("extdata", "Aciclovir.pkml", package = "ospsuite")
sim <- loadSimulation(simFilePath)
simResults <- runSimulation(sim)
outputPath <- "Organism|PeripheralVenousBlood|Aciclovir|Plasma (Peripheral Venous Blood)"

# observed data
obsData <- lapply(
  c("ObsDataAciclovir_1.pkml", "ObsDataAciclovir_2.pkml", "ObsDataAciclovir_3.pkml"),
  function(x) loadDataSetFromPKML(system.file("extdata", x, package = "ospsuite"))
)
names(obsData) <- lapply(obsData, function(x) x$name)

myDataCombined <- DataCombined$new()

myDataCombined$addSimulationResults(
  simulationResults = simResults,
  quantitiesOrPaths = outputPath,
  groups = "Aciclovir PVB"
)

myDataCombined$addDataSets(
  obsData$`Vergin 1995.Iv`,
  groups = "Aciclovir PVB"
)
```

## Profile plots

Time profile plots visualize the pharmacokinetics of the drug in question and help assess if the observed data (represented by points and error bars) match the simulated data (represented by lines).

```{r}
plotIndividualTimeProfile(myDataCombined)
```

## Observed versus simulated scatter plot 

Observed versus simulated plots show if simulated time points and observed time points follow a linear trend.

```{r}
plotObservedVsSimulated(myDataCombined)
```

## Residuals versus time or simulated scatter plot

Residual plots show if there is a systematic bias in how the simulation represents values either in high-concentration or low-concentration regions, or, alternatively, in early or late time periods.

```{r}
plotResidualsVsSimulated(myDataCombined)
```


```{r}
plotResidualsVsTime(myDataCombined)
```

## Customizing plot aesthetics

The aesthetics for plots can be customized using the `DefaultPlotConfiguration` class, which provides various class members that can be used to modify the *look* of the plot.

```{r}
myPlotConfiguration <- DefaultPlotConfiguration$new()

myPlotConfiguration$xUnit <- ospUnits$Time$s
myPlotConfiguration$yUnit <- ospUnits$`Concentration [mass]`$`Âµg/l`

myPlotConfiguration$title <- "Example: Customizing a Plot"
myPlotConfiguration$subtitle <- "Using `DefaultPlotConfiguration` class"
myPlotConfiguration$caption <- "Source: `Aciclovir` data"

myPlotConfiguration$legendPosition <- tlf::LegendPositions$outsideRight
myPlotConfiguration$yAxisScale <- tlf::Scaling$log
```

This configuration class can be passed to all plotting functions:

```{r}
plotIndividualTimeProfile(myDataCombined, myPlotConfiguration)
```

## Saving plots

The plots returned by plotting functions are `ggplot` objects. They can be modified further and saved to files with `{ggplot2}` functions:

```{r save-plots, eval=FALSE}
plotObject <- plotIndividualTimeProfile(dataCombined)
ggplot2::ggsave(filename = "aciclovir_time_profile.png", plotObject, width = 8, height = 4)
```
