<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ospsuite">
<title>Working with `DataCombined` class • ospsuite</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with `DataCombined` class">
<meta property="og:description" content="ospsuite">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ospsuite</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">11.1.197</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ospsuite.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Primary functions</h6>
    <a class="dropdown-item" href="../articles/load-get.html">Loading a simulation and accessing entities</a>
    <a class="dropdown-item" href="../articles/set-values.html">Changing parameter and molecule start values</a>
    <a class="dropdown-item" href="../articles/run-simulation.html">Running a simulation</a>
    <a class="dropdown-item" href="../articles/pk-analysis.html">Calculating PK parameters of simulation outputs</a>
    <a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity analysis</a>
    <a class="dropdown-item" href="../articles/create-individual.html">Creating individuals</a>
    <a class="dropdown-item" href="../articles/create-run-population.html">Population simulations</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Figure creation</h6>
    <a class="dropdown-item" href="../articles/observed-data.html">Observed data</a>
    <a class="dropdown-item" href="../articles/data-combined.html">Working with `DataCombined` class</a>
    <a class="dropdown-item" href="../articles/data-combined-plotting.html">Visualizations with `DataCombined`</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Miscellaneous</h6>
    <a class="dropdown-item" href="../articles/efficient-calculations.html">Efficient calculation</a>
    <a class="dropdown-item" href="../articles/table-parameters.html">Table parameters</a>
    <a class="dropdown-item" href="../articles/unit-conversion.html">Dimensions and Units</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/open-systems-pharmacology/ospsuite-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="data-combined_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Working with `DataCombined` class</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-systems-pharmacology/ospsuite-r/blob/HEAD/vignettes/data-combined.Rmd" class="external-link"><code>vignettes/data-combined.Rmd</code></a></small>
      <div class="d-none name"><code>data-combined.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In Modeling and Simulation (M&amp;S) workflows, we often need to work with multiple observed and/or simulated datasets. Some of these datasets can be linked together in a group (e.g., the simulated and the corresponding observed data) for analysis and visualization.</p>
<p>The <code>DataCombined</code> class in <a href="https://github.com/open-systems-pharmacology/ospsuite-r" class="external-link">ospsuite</a> provides a container to store data, to group them, and to transform them (e.g. scale or offset). The class accepts data coming from <code>SimulationResults</code> or as a <code>DataSet</code> object (see <a href="observed-data.html">Observed data</a>).</p>
<p>Let’s first generate some simulation results and load observed data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/open-systems-pharmacology/ospsuite-r" class="external-link">ospsuite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulation results</span></span>
<span><span class="va">simFilePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Aciclovir.pkml"</span>, package <span class="op">=</span> <span class="st">"ospsuite"</span><span class="op">)</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadSimulation.html">loadSimulation</a></span><span class="op">(</span><span class="va">simFilePath</span><span class="op">)</span></span>
<span><span class="va">simResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSimulation.html">runSimulation</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="va">outputPath</span> <span class="op">&lt;-</span> <span class="st">"Organism|PeripheralVenousBlood|Aciclovir|Plasma (Peripheral Venous Blood)"</span></span>
<span></span>
<span><span class="co"># observed data</span></span>
<span><span class="va">obsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ObsDataAciclovir_1.pkml"</span>, <span class="st">"ObsDataAciclovir_2.pkml"</span>, <span class="st">"ObsDataAciclovir_3.pkml"</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/loadDataSetFromPKML.html">loadDataSetFromPKML</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">x</span>, package <span class="op">=</span> <span class="st">"ospsuite"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Name the elements of the list according to the names of the loaded `DataSet`.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obsData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">obsData</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<p>Typically, <code>DataCombined</code> is used to create figures using the <code>plotXXX()</code> functions. The different plot types are described in <a href="data-combined-plotting.html">Visualizations with <code>DataCombined</code></a>. To visualize the different functionalities of <code>DataCombined</code> in this document, we will use the <code><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="creating-datacombined-object">Creating <code>DataCombined</code> object<a class="anchor" aria-label="anchor" href="#creating-datacombined-object"></a>
</h2>
<p>First, we create a new instance of <code>DataCombined</code> class.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DataCombined.html">DataCombined</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then we add simulated results to this object using <code>$addSimulationResults()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">addSimulationResults</span><span class="op">(</span></span>
<span>  simulationResults <span class="op">=</span> <span class="va">simResults</span>,</span>
<span>  quantitiesOrPaths <span class="op">=</span> <span class="va">outputPath</span>,</span>
<span>  names <span class="op">=</span> <span class="st">"Aciclovir Plasma"</span>,</span>
<span>  groups <span class="op">=</span> <span class="st">"Aciclovir PVB"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next we add observed data to this object using <code>$addDataSets()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">addDataSets</span><span class="op">(</span></span>
<span>  <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span>,</span>
<span>  groups <span class="op">=</span> <span class="st">"Aciclovir PVB"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Every data, be it simulated results or from <code>DataSet</code>, must have a unique name within <code>DataCombined</code>. If not specified by user, the path of simulated results or the <code>$name</code> property of the <code>DataSet</code> are used as the name. Alternatively, we can define the name when adding the data, as in the above example adding simulated results.</p>
<p>There are a few things to keep in mind here:</p>
<ul>
<li>It doesn’t matter in which order observed or simulated datasets are added.</li>
<li>You can add multiple <code>DataSet</code> objects in <code>$addDataSets()</code> method call.</li>
<li>You can add only a single instance of <code>SimulationResults</code> in <code>$addSimulationResults()</code> method call.</li>
<li>If you add a dataset with the same name as existing (e.g., adding simulation results from multiple simulations and not specifying the name, so the path of the results is used as the name), the new data will replace the existing.</li>
</ul>
</div>
<div class="section level2">
<h2 id="grouping">Grouping<a class="anchor" aria-label="anchor" href="#grouping"></a>
</h2>
<p>Since the <code>DataCombined</code> object can store many datasets, some of them may naturally form a grouping and you would wish to track this in the object. Both <code>$addDataSets()</code> and <code>$addSimulationResults()</code> allow group specification via <code>groups</code> argument.</p>
<p>When being plotted, data sets without a grouping will appear with distinct color, line style (for simulated results), or symbol style (for observed data) with a separate entry in the legend, with the name of the data set being the legend entry.</p>
<p>Though it is possible to group data with different dimensions, it makes sense to only group data sets that have the same dimension (or dimensions that can be transformed into each other, like <code>Amount</code> and <code>Mass</code>) in order to be able to compare the data. Grouping data sets with different dimensions most likely will result in an error when trying to create plots or calculating residuals with such a <code>DataCombined</code>.</p>
<p>Let’s create a <code>DataCombined</code> and add simulation results and observed data <em>without</em> specifying their grouping and create a time profile:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DataCombined.html">DataCombined</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">addSimulationResults</span><span class="op">(</span></span>
<span>  simulationResults <span class="op">=</span> <span class="va">simResults</span>,</span>
<span>  quantitiesOrPaths <span class="op">=</span> <span class="va">outputPath</span>,</span>
<span>  names <span class="op">=</span> <span class="st">"Aciclovir Plasma"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">addDataSets</span><span class="op">(</span></span>
<span>  <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile</a></span><span class="op">(</span>dataCombined <span class="op">=</span> <span class="va">myDataCombined</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-combined_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>If you do not specify <code>groups</code> when you add datasets, and wish to update groupings later, you can use the <code>$setGroups()</code> method. All data within one group will get one entry in the legend with the name of the group, and will be plotted with the same color.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">setGroups</span><span class="op">(</span></span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aciclovir Plasma"</span>, <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>,</span>
<span>  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aciclovir PVB"</span>, <span class="st">"Aciclovir PVB"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile</a></span><span class="op">(</span>dataCombined <span class="op">=</span> <span class="va">myDataCombined</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-combined_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>At any point, you can check the current names and groupings with the following active field:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="va">groupMap</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 x 3</span></span></span>
<span><span class="co">#&gt;   group         name             dataType </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Aciclovir PVB Aciclovir Plasma simulated</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Aciclovir PVB Vergin 1995.Iv   observed</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="transformations">Transformations<a class="anchor" aria-label="anchor" href="#transformations"></a>
</h2>
<p>Sometimes the raw data included in <code>DataCombined</code> needs to be transformed using specified offset and scale factor values.</p>
<p>This is supported via <code>$setDataTransformations()</code> method, where you can specify the names of datasets, and offsets and scale factors. If these arguments are scalar (i.e., of length 1), then the same value will be applied to all specified names. Scale factors are unitless values by which raw data values will be multiplied, offsets are added to the raw values without any conversion and must therefore be in the same units as the raw data.</p>
<p>The internal data frame in <code>DataCombined</code> will be transformed with the specified parameters, with the new columns computed as:</p>
<ul>
<li>For x values: <code>newXValue = (rawXValue + xOffset) * xScaleFactor</code>
</li>
<li>For y values: <code>newYValue = (rawYValue + yOffset) * yScaleFactor</code>
</li>
<li>For arithmetic error: <code>newErrorValue = rawErrorValue * abs(yScaleFactor)</code>
</li>
<li>For geometric error: no transformation.</li>
</ul>
<p>At any point, you can check the applied offsets and scale factors with the following active field:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="va">dataTransformations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 x 5</span></span></span>
<span><span class="co">#&gt;   name             xOffsets yOffsets xScaleFactors yScaleFactors</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Aciclovir Plasma        0        0             1             1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Vergin 1995.Iv          0        0             1             1</span></span></code></pre></div>
<p>Now lets take a closer look on possible situations where you would apply any transformations. Consider the observed data from the examples above. It reports concentrations of aciclovir after single intravenous administration.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombinedTranformations</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DataCombined.html">DataCombined</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myDataCombinedTranformations</span><span class="op">$</span><span class="fu">addDataSets</span><span class="op">(</span></span>
<span>  <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile</a></span><span class="op">(</span>dataCombined <span class="op">=</span> <span class="va">myDataCombinedTranformations</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-combined_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>However, we might want to use this data set with a simulation where aciclovir is administered 24 hours after simulation begin. To be able to compare simulation results with the data set, we can <em>offset</em> the observed data time by 24 hours. Keep in mind that the offset must be given in the same unit as the data set values are.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the units of the observed time values</span></span>
<span><span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span><span class="op">$</span><span class="va">xUnit</span></span>
<span><span class="co">#&gt; [1] "h"</span></span>
<span></span>
<span><span class="va">myDataCombinedTranformations</span><span class="op">$</span><span class="fu">setDataTransformations</span><span class="op">(</span></span>
<span>  forNames <span class="op">=</span> <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span><span class="op">$</span><span class="va">name</span>,</span>
<span>  xOffsets <span class="op">=</span> <span class="fl">24</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile</a></span><span class="op">(</span>dataCombined <span class="op">=</span> <span class="va">myDataCombinedTranformations</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-combined_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
<p>In the next step, we want to <em>normalize</em> observed concentrations to a dose. We can easily achieve this with the scale factor. In the next example, we normalize observed values to 250 mg dose by setting the <code>yScaleFactor</code> to 1/250:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombinedTranformations</span><span class="op">$</span><span class="fu">setDataTransformations</span><span class="op">(</span></span>
<span>  forNames <span class="op">=</span> <span class="va">obsData</span><span class="op">$</span><span class="va">`Vergin 1995.Iv`</span><span class="op">$</span><span class="va">name</span>,</span>
<span>  yScaleFactors <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">250</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotIndividualTimeProfile.html">plotIndividualTimeProfile</a></span><span class="op">(</span>dataCombined <span class="op">=</span> <span class="va">myDataCombinedTranformations</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-combined_files/figure-html/unnamed-chunk-12-1.png" width="100%"> Finally, offsetting the observation values might be useful when working with measurements of endogenous substrates, such as the hormone glucagon, and want to correct for the individual specific baseline levels of the hormone.</p>
</div>
<div class="section level2">
<h2 id="extracting-a-combined-data-frame">Extracting a combined data frame<a class="anchor" aria-label="anchor" href="#extracting-a-combined-data-frame"></a>
</h2>
<p>The data frame (also sometimes called as a table) data structure is central to R-based workflows, and, thus, we may wish to extract a data frame for datasets present in the object.</p>
<p>Internally, <code>DataCombined</code> extracts data frames for observed and simulated datasets and combines them.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">toDataFrame</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 504 x 27</span></span></span>
<span><span class="co">#&gt;    name        group dataT~1 xValues xUnit xDime~2 yValues yUnit yDime~3 yErro~4</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Aciclovir ~ Acic~ simula~       0 min   Time       0    µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Aciclovir ~ Acic~ simula~       1 min   Time       3.25 µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Aciclovir ~ Acic~ simula~       2 min   Time       9.10 µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Aciclovir ~ Acic~ simula~       3 min   Time      15.0  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Aciclovir ~ Acic~ simula~       4 min   Time      20.7  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Aciclovir ~ Acic~ simula~       5 min   Time      26.2  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Aciclovir ~ Acic~ simula~       6 min   Time      31.4  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Aciclovir ~ Acic~ simula~       7 min   Time      36.4  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Aciclovir ~ Acic~ simula~       8 min   Time      41.1  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Aciclovir ~ Acic~ simula~       9 min   Time      45.5  µmol~ Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 494 more rows, 17 more variables: yErrorType &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   yErrorUnit &lt;chr&gt;, IndividualId &lt;int&gt;, molWeight &lt;dbl&gt;, lloq &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Source &lt;chr&gt;, File &lt;chr&gt;, Sheet &lt;chr&gt;, Molecule &lt;chr&gt;, Species &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Organ &lt;chr&gt;, Compartment &lt;chr&gt;, `Study Id` &lt;chr&gt;, Gender &lt;chr&gt;, Dose &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Route &lt;chr&gt;, `Patient Id` &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   1: dataType, 2: xDimension, 3: yDimension, 4: yErrorValues</span></span></span></code></pre></div>
<p>This function returns a <a href="https://r4ds.had.co.nz/tibbles.html#tibbles-vs.-data.frame" class="external-link">tibble data frame</a>. If you wish to modify how it is printed, you can have a look at the available options <a href="https://pillar.r-lib.org/reference/pillar_options.html" class="external-link">here</a>. In fact, let’s change a few options and print the data frame again.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  pillar.width <span class="op">=</span> <span class="cn">Inf</span>, <span class="co"># show all columns</span></span>
<span>  pillar.min_chars <span class="op">=</span> <span class="cn">Inf</span> <span class="co"># to turn off truncation of column titles</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">myDataCombined</span><span class="op">$</span><span class="fu">toDataFrame</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 504 x 27</span></span></span>
<span><span class="co">#&gt;    name             group         dataType  xValues xUnit xDimension yValues</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Aciclovir Plasma Aciclovir PVB simulated       0 min   Time          0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Aciclovir Plasma Aciclovir PVB simulated       1 min   Time          3.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Aciclovir Plasma Aciclovir PVB simulated       2 min   Time          9.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Aciclovir Plasma Aciclovir PVB simulated       3 min   Time         15.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Aciclovir Plasma Aciclovir PVB simulated       4 min   Time         20.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Aciclovir Plasma Aciclovir PVB simulated       5 min   Time         26.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Aciclovir Plasma Aciclovir PVB simulated       6 min   Time         31.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Aciclovir Plasma Aciclovir PVB simulated       7 min   Time         36.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Aciclovir Plasma Aciclovir PVB simulated       8 min   Time         41.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Aciclovir Plasma Aciclovir PVB simulated       9 min   Time         45.5 </span></span>
<span><span class="co">#&gt;    yUnit  yDimension            yErrorValues yErrorType yErrorUnit IndividualId</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> µmol/l Concentration (molar)           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                    0</span>0</span>
<span><span class="co">#&gt;    molWeight  lloq Source File  Sheet Molecule Species Organ Compartment</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      225.    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt;    `Study Id` Gender Dose  Route `Patient Id`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 494 more rows</span></span></span></code></pre>
<p><a href="https://github.com/open-systems-pharmacology/ospsuite-r" class="external-link">ospsuite</a> also provides a few helper functions to modify the data frame further.</p>
<p>When multiple (observed and/or simulated) datasets are present in a data frame, they are likely to have different units. <code><a href="../reference/convertUnits.html">convertUnits()</a></code> function helps to convert them to a common unit. The function will not modify the <code>DataCombined</code> object but return a new data frame with unified units.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note that if you are using &lt;code&gt;DataCombined&lt;/code&gt; object for plotting functions, you don’t need to this conversion; the plotting functions will take care of this internally.&lt;/p&gt;"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/convertUnits.html">convertUnits</a></span><span class="op">(</span></span>
<span>  <span class="va">myDataCombined</span>,</span>
<span>  xUnit <span class="op">=</span> <span class="va">ospUnits</span><span class="op">$</span><span class="va">Time</span><span class="op">$</span><span class="va">s</span>,</span>
<span>  yUnit <span class="op">=</span> <span class="va">ospUnits</span><span class="op">$</span><span class="va">`Concentration [mass]`</span><span class="op">$</span><span class="va">`µg/l`</span>`</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 504 x 27</span></span></span>
<span><span class="co">#&gt;    name        group dataT~1 xValues xUnit xDime~2 yValues yUnit yDime~3 yErro~4</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Aciclovir ~ Acic~ simula~       0 s     Time         0  µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Aciclovir ~ Acic~ simula~      60 s     Time       733. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Aciclovir ~ Acic~ simula~     120 s     Time      <span style="text-decoration: underline;">2</span>050. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Aciclovir ~ Acic~ simula~     180 s     Time      <span style="text-decoration: underline;">3</span>382. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Aciclovir ~ Acic~ simula~     240 s     Time      <span style="text-decoration: underline;">4</span>668. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Aciclovir ~ Acic~ simula~     300 s     Time      <span style="text-decoration: underline;">5</span>901. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Aciclovir ~ Acic~ simula~     360 s     Time      <span style="text-decoration: underline;">7</span>077. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Aciclovir ~ Acic~ simula~     420 s     Time      <span style="text-decoration: underline;">8</span>194. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Aciclovir ~ Acic~ simula~     480 s     Time      <span style="text-decoration: underline;">9</span>249. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Aciclovir ~ Acic~ simula~     540 s     Time     <span style="text-decoration: underline;">10</span>242. µg/l  Concen~      <span style="color: #BB0000;">NA</span></span>m</span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 494 more rows, 17 more variables: yErrorType &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   yErrorUnit &lt;chr&gt;, IndividualId &lt;int&gt;, molWeight &lt;dbl&gt;, lloq &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Source &lt;chr&gt;, File &lt;chr&gt;, Sheet &lt;chr&gt;, Molecule &lt;chr&gt;, Species &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Organ &lt;chr&gt;, Compartment &lt;chr&gt;, `Study Id` &lt;chr&gt;, Gender &lt;chr&gt;, Dose &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Route &lt;chr&gt;, `Patient Id` &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   1: dataType, 2: xDimension, 3: yDimension, 4: yErrorValues</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-functionalities">Further functionalities<a class="anchor" aria-label="anchor" href="#further-functionalities"></a>
</h2>
<p>Grouping of simulated results with observed data inside <code>DataCombined</code> also allows to calculate the error between simulated results and observations using the <code><a href="../reference/calculateResiduals.html">calculateResiduals()</a></code> function. The function calculates the distance between each observed data point within the group and the simulated results. Simulation results interpolated if no simulated value is available for a certain observed time point. Observed data beyond simulated time is ignored, i.e., no <em>extrapolation</em> is performed.</p>
<p>There are two ways to calculate the distance (residuals) - linear and logarithmic - specified by the <code>scaling</code> argument. For linear scaling (<code>scaling = tlf::Scaling$lin</code>):</p>
<blockquote>
<p>Residuals are calculated as: Simulation value - Observed value. This means that the residuals are defined by absolute differences.</p>
</blockquote>
<p>For logarithmic scaling (<code>scaling = tlf::Scaling$log</code>):</p>
<blockquote>
<p>Residuals are calculated as: log(Simulation value) - log(Observed value) = log (Simulation Value / Observed Value). This means that the ratio of values is considered which is independent of the magnitude of the value. But for very small observed values, in particular close to 0 values, this can lead to problems, because log(10E-N) = -N can becomes large.</p>
</blockquote>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear residuals</span></span>
<span><span class="fu"><a href="../reference/calculateResiduals.html">calculateResiduals</a></span><span class="op">(</span><span class="va">myDataCombined</span>, scaling <span class="op">=</span> <span class="fu">tlf</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tlf/man/Scaling.html" class="external-link">Scaling</a></span><span class="op">$</span><span class="va">lin</span><span class="op">)</span><span class="op">$</span><span class="va">residualValues</span></span>
<span><span class="co">#&gt;  [1]  9.49304275 -0.14538952  0.17965548  1.84599976  3.52552442  3.64160094</span></span>
<span><span class="co">#&gt;  [7]  3.15654735  2.38392729  1.48703530  0.50532597  0.08009793 -0.14892803</span></span>
<span><span class="co">#&gt; [13] -0.29395086</span></span>
<span></span>
<span><span class="co"># Logarithmic residuals</span></span>
<span><span class="fu"><a href="../reference/calculateResiduals.html">calculateResiduals</a></span><span class="op">(</span><span class="va">myDataCombined</span>, scaling <span class="op">=</span> <span class="fu">tlf</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tlf/man/Scaling.html" class="external-link">Scaling</a></span><span class="op">$</span><span class="va">log</span><span class="op">)</span><span class="op">$</span><span class="va">residualValues</span></span>
<span><span class="co">#&gt;  [1]  0.104108908 -0.003164673  0.005480074  0.067421107  0.167165355</span></span>
<span><span class="co">#&gt;  [6]  0.209421219  0.251369532  0.250984965  0.281241351  0.198767801</span></span>
<span><span class="co">#&gt; [11]  0.059638034 -0.181845923 -1.001432113</span></span></code></pre></div>
<p>To quickly calculate the total error of the <code>DataCombined</code>, one can sum up the absolute values of the residuals:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear residuals</span></span>
<span><span class="va">totalError</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="../reference/calculateResiduals.html">calculateResiduals</a></span><span class="op">(</span><span class="va">myDataCombined</span>, scaling <span class="op">=</span> <span class="fu">tlf</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tlf/man/Scaling.html" class="external-link">Scaling</a></span><span class="op">$</span><span class="va">lin</span><span class="op">)</span><span class="op">$</span><span class="va">residualValues</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">totalError</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 26.88703</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizations-with-datacombined">Visualizations with <code>DataCombined</code><a class="anchor" aria-label="anchor" href="#visualizations-with-datacombined"></a>
</h2>
<p>See <a href="data-combined-plotting.html">Visualizations with <code>DataCombined</code></a> describing functions that can visualize data stored in <code>DataCombined</code> object.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Sevestre, Pavel Balazki, Juri Solodenko, <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
